<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapeer 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ball.mapper.GroupMapper">
    <insert id="insertGroup" parameterType="com.ball.vo.GroupVO">
        insert into group_table (user_id_group_header, group_name, group_category, group_is_secret,
                                 group_password, group_person_count, group_content, group_reg_date, group_mod_date)
        values(#{user_id_group_header},#{group_name},#{group_category}, #{group_is_secret},
            #{group_password}, #{group_person_count}, #{group_content}, sysdate(), sysdate())
    </insert>

    <select id="allRead" resultType="com.ball.vo.GroupVO">
        select * from group_table where group_id = #{group_id}
    </select>

    <select id="get" resultType="com.ball.vo.GroupVO">
        select * from group_table where group_id = #{group_id}
    </select>
    <select id="selectGroupList" resultType="com.ball.vo.GroupVO">
        select g.group_id, g.user_id_group_header, u.user_nickname as user_nickname_group_header,
        g.group_name, g.group_category, g.group_is_secret, count(gr.user_id) as group_join_person_number,
        g.group_person_count, g.group_reg_date
        from group_table g
        left outer join user u on g.user_id_group_header = u.user_id
        left outer join group_user_relationship gr on gr.group_id = g.group_id
        <where>
            <if test="category != null">
                g.group_category like CONCAT('%',#{category},'%')
            </if>
            <if test="keyword != null">
                And (g.group_name like CONCAT('%',#{keyword},'%') or g.group_content like CONCAT('%',#{keyword},'%'))
            </if>
            <if test="criterionNumber > amount">
                <![CDATA[
                AND g.group_id < #{criterionNumber}
                ]]>
            </if>
        </where>
        group by g.group_id
        order by g.group_id desc
        limit #{amount}
    </select>
    <update id="updateGroup">
        update group_table set group_name = #{group_name}, group_category = #{group_category},
                               group_is_secret = #{group_is_secret}, group_password = #{group_password},
                               group_person_count = #{group_person_count}, group_content = #{group_content},
                               group_mod_date = sysdate()
            where group_id = #{group_id}
    </update>

    <select id="getTotalCount" resultType="int">
        select count(*) from group_table where group_id > 0
    </select>
    <delete id="groupDelete">
        delete from group_table where group_id= #{group_id}
    </delete>

    <select id="readGroup" resultType="com.ball.vo.GroupVO">
        select * from group_table where group_id = #{group_id}
    </select>
</mapper>